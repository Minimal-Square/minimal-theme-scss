this.Shopify=this.Shopify||{},this.Shopify.theme=this.Shopify.theme||{},this.Shopify.theme.PredictiveSearchComponent=function(r){"use strict";var l={search_path:(r=r&&r.hasOwnProperty("default")?r.default:r).SEARCH_PATH,resources:{type:[r.TYPES.PRODUCT],options:{unavailable_products:r.UNAVAILABLE_PRODUCTS.LAST,fields:[r.FIELDS.TITLE,r.FIELDS.VENDOR,r.FIELDS.PRODUCT_TYPE,r.FIELDS.VARIANTS_TITLE]}}};function e(e){if(!(e&&e.selectors&&e.selectors.input&&u(e.selectors.input)&&e.selectors.result&&u(e.selectors.result)&&e.resultTemplateFct&&c(e.resultTemplateFct)&&e.numberOfResultsTemplateFct&&c(e.numberOfResultsTemplateFct)&&e.loadingResultsMessageTemplateFct&&c(e.loadingResultsMessageTemplateFct))){var t=new TypeError("PredictiveSearchComponent config is not valid");throw t.type="argument",t}var s,i,n,o;(this.nodes=(s=e.selectors,{input:document.querySelector(s.input),reset:document.querySelector(s.reset),result:document.querySelector(s.result)}),(i=this.nodes)&&i.input&&i.result&&"INPUT"===i.input.tagName)?(this._searchKeyword="",this.resultTemplateFct=e.resultTemplateFct,this.numberOfResultsTemplateFct=e.numberOfResultsTemplateFct,this.loadingResultsMessageTemplateFct=e.loadingResultsMessageTemplateFct,this.numberOfResults=e.numberOfResults||4,this.classes={visibleVariant:e.visibleVariant?e.visibleVariant:"predictive-search-wrapper--visible",itemSelected:e.itemSelectedClass?e.itemSelectedClass:"predictive-search-item--selected",clearButtonVisible:e.clearButtonVisibleClass?e.clearButtonVisibleClass:"predictive-search__clear-button--visible"},this.selectors={searchResult:e.searchResult?e.searchResult:"[data-search-result]"},this.callbacks={onBodyMousedown:(n=e).onBodyMousedown,onBeforeOpen:n.onBeforeOpen,onOpen:n.onOpen,onBeforeClose:n.onBeforeClose,onClose:n.onClose,onInputFocus:n.onInputFocus,onInputKeyup:n.onInputKeyup,onInputBlur:n.onInputBlur,onInputReset:n.onInputReset,onBeforeDestroy:n.onBeforeDestroy,onDestroy:n.onDestroy},(o=this.nodes.input).setAttribute("autocorrect","off"),o.setAttribute("autocomplete","off"),o.setAttribute("autocapitalize","off"),o.setAttribute("spellcheck","false"),this._addInputEventListeners(),this._addBodyEventListener(),this._addAccessibilityAnnouncer(),this._toggleClearButtonVisibility(),this.predictiveSearch=new r(e.PredictiveSearchAPIConfig?e.PredictiveSearchAPIConfig:l),this.predictiveSearch.on("success",this._handlePredictiveSearchSuccess.bind(this)),this.predictiveSearch.on("error",this._handlePredictiveSearchError.bind(this))):console.warn("Could not find valid nodes")}function t(e){return Object.prototype.toString.call(e)}function u(e){return"[object String]"===t(e)}function s(e){return"[object Boolean]"===t(e)}function c(e){return"[object Function]"===t(e)}return e.prototype.isResultVisible=!1,e.prototype.results={},e.prototype._latencyTimer=null,e.prototype._resultNodeClicked=!1,e.prototype._addInputEventListeners=function(){var e=this.nodes.input,t=this.nodes.reset;e&&(this._handleInputFocus=this._handleInputFocus.bind(this),this._handleInputBlur=this._handleInputBlur.bind(this),this._handleInputKeyup=this._handleInputKeyup.bind(this),this._handleInputKeydown=this._handleInputKeydown.bind(this),e.addEventListener("focus",this._handleInputFocus),e.addEventListener("blur",this._handleInputBlur),e.addEventListener("keyup",this._handleInputKeyup),e.addEventListener("keydown",this._handleInputKeydown),t&&(this._handleInputReset=this._handleInputReset.bind(this),t.addEventListener("click",this._handleInputReset)))},e.prototype._removeInputEventListeners=function(){var e=this.nodes.input;e.removeEventListener("focus",this._handleInputFocus),e.removeEventListener("blur",this._handleInputBlur),e.removeEventListener("keyup",this._handleInputKeyup),e.removeEventListener("keydown",this._handleInputKeydown)},e.prototype._addBodyEventListener=function(){this._handleBodyMousedown=this._handleBodyMousedown.bind(this),document.querySelector("body").addEventListener("mousedown",this._handleBodyMousedown)},e.prototype._removeBodyEventListener=function(){document.querySelector("body").removeEventListener("mousedown",this._handleBodyMousedown)},e.prototype._removeClearButtonEventListener=function(){var e=this.nodes.reset;e&&e.removeEventListener("click",this._handleInputReset)},e.prototype._handleBodyMousedown=function(e){if(this.isResultVisible&&null!==this.nodes)if(e.target.isEqualNode(this.nodes.input)||this.nodes.input.contains(e.target)||e.target.isEqualNode(this.nodes.result)||this.nodes.result.contains(e.target))this._resultNodeClicked=!0;else if(c(this.callbacks.onBodyMousedown)){var t=this.callbacks.onBodyMousedown(this.nodes);s(t)&&t&&this.close()}else this.close()},e.prototype._handleInputFocus=function(e){if(c(this.callbacks.onInputFocus)){var t=this.callbacks.onInputFocus(this.nodes);if(s(t)&&!t)return!1}return 0<e.target.value.length&&this._search(),!0},e.prototype._handleInputBlur=function(){return setTimeout(function(){if(c(this.callbacks.onInputBlur)){var e=this.callbacks.onInputBlur(this.nodes);if(s(e)&&!e)return!1}return!document.activeElement.isEqualNode(this.nodes.reset)&&(this._resultNodeClicked?this._resultNodeClicked=!1:void this.close())}.bind(this)),!0},e.prototype._addAccessibilityAnnouncer=function(){this._accessibilityAnnouncerDiv=window.document.createElement("div"),this._accessibilityAnnouncerDiv.setAttribute("style","position: absolute !important; overflow: hidden; clip: rect(0 0 0 0); height: 1px; width: 1px; margin: -1px; padding: 0; border: 0;"),this._accessibilityAnnouncerDiv.setAttribute("data-search-announcer",""),this._accessibilityAnnouncerDiv.setAttribute("aria-live","polite"),this._accessibilityAnnouncerDiv.setAttribute("aria-atomic","true"),this.nodes.result.parentElement.appendChild(this._accessibilityAnnouncerDiv)},e.prototype._removeAccessibilityAnnouncer=function(){this.nodes.result.parentElement.removeChild(this._accessibilityAnnouncerDiv)},e.prototype._updateAccessibilityAttributesAfterSelectingElement=function(e,t){this.nodes.input.setAttribute("aria-activedescendant",t.id),e&&e.removeAttribute("aria-selected"),t.setAttribute("aria-selected",!0)},e.prototype._clearAriaActiveDescendant=function(){this.nodes.input.setAttribute("aria-activedescendant","")},e.prototype._announceNumberOfResultsFound=function(e){var t=this._accessibilityAnnouncerDiv.innerHTML,s=this.numberOfResultsTemplateFct(e);t===s&&(s+="&nbsp;"),this._accessibilityAnnouncerDiv.innerHTML=s},e.prototype._announceLoadingState=function(){this._accessibilityAnnouncerDiv.innerHTML=this.loadingResultsMessageTemplateFct()},e.prototype._handleInputKeyup=function(e){if(c(this.callbacks.onInputKeyup)){var t=this.callbacks.onInputKeyup(this.nodes);if(s(t)&&!t)return!1}if(this._toggleClearButtonVisibility(),this.isResultVisible&&null!==this.nodes){if(38===e.keyCode)return this._navigateOption(e,"UP"),!0;if(40===e.keyCode)return this._navigateOption(e,"DOWN"),!0;if(13===e.keyCode)return this._selectOption(),!0;27===e.keyCode&&this.close()}return e.target.value.length<=0?(this.close(),this._setKeyword("")):0<e.target.value.length&&this._search(),!0},e.prototype._handleInputKeydown=function(e){13===e.keyCode&&null!=this._getSelectedOption()&&e.preventDefault(),38!==e.keyCode&&40!==e.keyCode||e.preventDefault()},e.prototype._handleInputReset=function(e){if(e.preventDefault(),c(this.callbacks.onInputReset)){var t=this.callbacks.onInputReset(this.nodes);if(s(t)&&!t)return!1}return this.nodes.input.value="",this.nodes.input.focus(),this._toggleClearButtonVisibility(),this.close(),!0},e.prototype._navigateOption=function(e,t){var s=this._getSelectedOption();if(s)if("DOWN"===t){var i=s.nextElementSibling;i&&(s.classList.remove(this.classes.itemSelected),i.classList.add(this.classes.itemSelected),this._updateAccessibilityAttributesAfterSelectingElement(s,i))}else{var n=s.previousElementSibling;n&&(s.classList.remove(this.classes.itemSelected),n.classList.add(this.classes.itemSelected),this._updateAccessibilityAttributesAfterSelectingElement(s,n))}else{var o=this.nodes.result.querySelector(this.selectors.searchResult);o.classList.add(this.classes.itemSelected),this._updateAccessibilityAttributesAfterSelectingElement(null,o)}},e.prototype._getSelectedOption=function(){return this.nodes.result.querySelector("."+this.classes.itemSelected)},e.prototype._selectOption=function(){var e=this._getSelectedOption();e&&e.querySelector("a, button").click()},e.prototype._search=function(){var e=this.nodes.input.value;this._searchKeyword!==e&&(clearTimeout(this._latencyTimer),this._latencyTimer=setTimeout(function(){this.results.isLoading=!0,this._announceLoadingState(),this.nodes.result.classList.add(this.classes.visibleVariant),this.nodes.result.innerHTML=this.resultTemplateFct(this.results)}.bind(this),500),this.predictiveSearch.query(e),this._setKeyword(e))},e.prototype._handlePredictiveSearchSuccess=function(e){clearTimeout(this._latencyTimer),this.results=e.resources.results,this.results.isLoading=!1,this.results.products=this.results.products.slice(0,this.numberOfResults),this.results.canLoadMore=this.numberOfResults<=this.results.products.length,this.results.searchQuery=this.nodes.input.value,0<this.results.products.length||this.results.searchQuery?(this.nodes.result.innerHTML=this.resultTemplateFct(this.results),this._announceNumberOfResultsFound(this.results),this.open()):(this.nodes.result.innerHTML="",this._closeOnNoResults())},e.prototype._handlePredictiveSearchError=function(){clearTimeout(this._latencyTimer),this.nodes.result.innerHTML="",this._closeOnNoResults()},e.prototype._closeOnNoResults=function(){this.nodes&&this.nodes.result.classList.remove(this.classes.visibleVariant),this.isResultVisible=!1},e.prototype._setKeyword=function(e){this._searchKeyword=e},e.prototype._toggleClearButtonVisibility=function(){this.nodes.reset&&(0<this.nodes.input.value.length?this.nodes.reset.classList.add(this.classes.clearButtonVisible):this.nodes.reset.classList.remove(this.classes.clearButtonVisible))},e.prototype.open=function(){if(!this.isResultVisible){if(c(this.callbacks.onBeforeOpen)){var e=this.callbacks.onBeforeOpen(this.nodes);if(s(e)&&!e)return!1}return this.nodes.result.classList.add(this.classes.visibleVariant),this.nodes.input.setAttribute("aria-expanded",!0),this.isResultVisible=!0,c(this.callbacks.onOpen)&&this.callbacks.onOpen(this.nodes)||!0}},e.prototype.close=function(){if(!this.isResultVisible)return!0;if(c(this.callbacks.onBeforeClose)){var e=this.callbacks.onBeforeClose(this.nodes);if(s(e)&&!e)return!1}return this.nodes&&this.nodes.result.classList.remove(this.classes.visibleVariant),this.nodes.input.setAttribute("aria-expanded",!1),this._clearAriaActiveDescendant(),this._setKeyword(""),c(this.callbacks.onClose)&&this.callbacks.onClose(this.nodes),this.isResultVisible=!1,this.results={},!0},e.prototype.destroy=function(){if(this.close(),c(this.callbacks.onBeforeDestroy)){var e=this.callbacks.onBeforeDestroy(this.nodes);if(s(e)&&!e)return!1}var t;return this.nodes.result.classList.remove(this.classes.visibleVariant),(t=this.nodes.input).removeAttribute("autocorrect","off"),t.removeAttribute("autocomplete","off"),t.removeAttribute("autocapitalize","off"),t.removeAttribute("spellcheck","false"),this._removeInputEventListeners(),this._removeBodyEventListener(),this._removeAccessibilityAnnouncer(),this._removeClearButtonEventListener(),c(this.callbacks.onDestroy)&&this.callbacks.onDestroy(this.nodes),!0},e.prototype.clearAndClose=function(){this.nodes.input.value="",this.close()},e}(Shopify.theme.PredictiveSearch);
